<config-template xmlns="http://tail-f.com/ns/config/1.0">
  <devices xmlns="http://tail-f.com/ns/ncs">
  <device>
    <name>{$NODE}</name>
      <config>
      <configuration xmlns="http://xml.juniper.net/xnm/1.1/xnm">
      <interfaces>
                <interface>
                    <name>{$INTERFACE}</name>
                    <unit>
                        <name>{$ID}</name>
                        <vlan-id>{$ID}</vlan-id>
                        <family>
                          <inet>
                            <address>
                              <name>{$LIP}/30</name>
                            </address>
                          </inet>
                        </family>
                    </unit>
                </interface>
      </interfaces>
 <routing-instances>
      <instance>
        <name>vrf-{$ID}</name>
        <instance-type>vrf</instance-type>
        <interface>
          <name>{$INTERFACE}.{$ID}</name>
        </interface>
        <route-distinguisher>
          <rd-type>{$LOOPBACK}:{$ID}</rd-type>
        </route-distinguisher>
        <vrf-import>PL-VRF-{$ID}-IMP</vrf-import>
        <vrf-export>PL-VRF-{$ID}-EXP</vrf-export>
        <protocols>
          <bgp>
            <group>
              <name>eBGP-65001</name>
              <family>
                <inet>
                  <unicast>
                  </unicast>
                </inet>
              </family>
              <peer-as>65001</peer-as>
              <as-override/>
              <neighbor>
                <name>{$PIP}</name>
                <export>PL-VRF-{$ID}-eBGP-OUT</export>
              </neighbor>
            </group>
          </bgp>
        </protocols>
      </instance>
      </routing-instances>
       <policy-options>
        <policy-statement>
          <name>PL-VRF-{$ID}-EXP</name>
          <term>
            <name>eBGP</name>
            <from>
              <protocol>bgp</protocol>
            </from>
            <then>
              <community>
                <key1>add</key1>
                <community-name>RT-VPN-{$ID}</community-name>
              </community>
              <accept/>
            </then>
          </term>
        </policy-statement>
        <policy-statement>
          <name>PL-VRF-{$ID}-IMP</name>
          <term>
            <name>VPN-{$ID}</name>
            <from>
              <community>RT-VPN-{$ID}</community>
            </from>
            <then>
              <accept/>
            </then>
          </term>
        </policy-statement>
        <policy-statement>
          <name>PL-VRF-{$ID}-eBGP-OUT</name>
          <term>
            <name>BGP</name>
            <from>
              <protocol>bgp</protocol>
            </from>
            <then>
              <metric>
                <metric>100</metric>
              </metric>
              <community>
                <key1>delete</key1>
                <community-name>RT-ALL</community-name>
              </community>
            </then>
          </term>
        </policy-statement>
        <community>
          <name>RT-ALL</name>
          <members>target:*:*</members>
        </community>
        <community>
          <name>RT-VPN-{$ID}</name>
          <members>target:65000:{$ID}</members>
        </community>
      </policy-options>
      </configuration>
      </config>
  </device>
  </devices>
</config-template>
